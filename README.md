# Pi-hole to pfSense DHCP Configuration Migration

## Overview
This repository contains Python scripts designed to facilitate the migration of network configurations from a Pi-hole-based DHCP setup to a pfSense-based router. The transition involves converting Pi-hole's `dnsmasq` configuration file into a format compatible with pfSense, allowing to bulk transfer static mappings.

## Use Case
I have been transitioning my network from a Google Wifi + piHole DHCP setup to a pfSense setup.
With more than 100 static IP, I needed a way to export/import the mapping.
piHole is using a dnsMasq file so it is already CSV ready
pfSense however is using a specific XML file.
The idea is to convert the pfSense export.xml into a CSV, then add the entries from piHole and then regenerate the xml file and import it back to pfSense.

---

## Scripts

### 1. `pihole2csv.py`
Converts Pi-hole's export file (`pihole_export.txt`) into a  "pfSense ready CSV format" (`pihole_staticmaps.csv`).

#### Usage:
```bash
python pihole2csv.py --input pihole_export.txt --output pihole_staticmaps.csv
```

#### Output:
A CSV file containing expected pfSense tags like MAC addresses, client IDs, IP addresses, and hostnames.

---

### 2. `pfsense2csv.py`
Extracts existing static mappings from a pfSense configuration XML file (`pfsense_config.xml`) and exports them into a CSV format (`pfsense_staticmaps.csv`).

#### Usage:
```bash
python pfsense2csv.py --input-file pfsense_config.xml --output-file pfsense_staticmaps.csv
```

#### Output:
A CSV file containing expected pfSense tags like MAC addresses, client IDs, IP addresses, and hostnames.

---

### 3. `csv2pfsense.py`
Merges the CSV files generated by the previous scripts (`pihole_staticmaps.csv` and `pfsense_staticmaps.csv`) and converts them into a pfSense-compatible XML file.

#### Usage:
```bash
python csv2pfsense.py --csv merged_staticmaps.csv --input-xml template_config.xml --output-xml new_config.xml --overwrite
```

#### Output:
An XML file ready to be imported into pfSense to apply the updated static mappings.

---

## Workflow

1. **Export Configuration Files:**
   - Export the Pi-hole configuration file (`dnsmasq`/`pihole_export.txt`).
   - Export the pfSense configuration file (`pfsense_config.xml`).

2. **Convert Files to CSV:**
   - Use `pihole2csv.py` to convert the Pi-hole file into `pihole_staticmaps.csv`.
   - Use `pfsense2csv.py` to convert the pfSense XML file into `pfsense_staticmaps.csv`.

3. **Merge CSV Files:**
   - Merge the two CSV files into a single unified file (`merged_staticmaps.csv`).

4. **Generate pfSense XML:**
   - Use `csv2pfsense.py` to convert the merged CSV file into a pfSense-compatible XML format.

5. **Reimport Configuration into pfSense:**
   - Import the newly generated XML file into pfSense.

---

## Prerequisites
- A working Pi-hole DNS configuration export file
- A pfSense XML configuration export file

---

## Notes
- The `--overwrite` flag in `csv2pfsense.py` ensures that any existing static mappings in pfSense are cleared before applying the new ones. Use with caution.
- Ensure backups of your original configurations before running the scripts to avoid data loss.

